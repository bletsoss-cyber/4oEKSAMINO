<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uni Hub - Focus Mode</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">

    <style>
        /* --- 1. MEMORY & FOCUS COLOR PALETTE --- */
        :root {
            /* ÎšÎ¥Î¡Î™ÎŸ Î˜Î•ÎœÎ‘: SAGE GREEN & DEEP TEAL (Î£Î¥Î“ÎšÎ•ÎÎ¤Î¡Î©Î£Î—) */
            --bg-dashboard: #f0fdf4; /* Î Î¿Î»Ï Î±Ï€Î±Î»ÏŒ Ï€ÏÎ¬ÏƒÎ¹Î½Î¿ */
            --bg-viewer: #fdfbf7;    /* ÎšÏÎµÎ¼ (ÎÎµÎºÎ¿ÏÏÎ±ÏƒÏ„Î¿ Î³Î¹Î± Ï„Î± Î¼Î¬Ï„Î¹Î±) */
            --primary: #15803d;      /* Deep Green (Focus) */
            --accent: #0f766e;       /* Teal (Calm) */
            --text-main: #1e293b;    /* Slate Dark */
            --text-muted: #64748b;
            --card-bg: rgba(255, 255, 255, 0.85);
            --border: 1px solid rgba(21, 128, 61, 0.2);
            --success: #10b981;
            --error: #ef4444;
        }

        /* RESET & BASICS */
        body {
            background-color: var(--bg-dashboard);
            color: var(--text-main);
            font-family: 'Outfit', sans-serif;
            margin: 0; padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
            /* Î”Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÏŒ background pattern */
            background-image: radial-gradient(#15803d 0.5px, transparent 0.5px);
            background-size: 20px 20px;
        }

        * { box-sizing: border-box; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .container { max-width: 1200px; margin: 0 auto; padding: 30px; display: none; }

        /* --- LOGIN SCREEN --- */
        .login-wrapper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            background: #ecfdf5; z-index: 2000;
        }
        .login-box {
            background: white; padding: 40px; border-radius: 24px; width: 350px; text-align: center;
            box-shadow: 0 20px 60px rgba(21, 128, 61, 0.15); border: var(--border);
        }
        .login-input {
            width: 100%; padding: 12px; margin: 10px 0; background: #f8fafc;
            border: 1px solid #cbd5e1; border-radius: 12px; outline: none;
        }
        .login-input:focus { border-color: var(--primary); background: white; }
        .login-btn {
            width: 100%; padding: 12px; margin-top: 20px; background: var(--primary);
            color: white; font-weight: 700; border: none; border-radius: 12px; cursor: pointer;
        }
        .login-btn:hover { background: var(--accent); transform: translateY(-2px); }
        .toggle-text { font-size: 0.85rem; margin-top: 15px; cursor: pointer; color: var(--text-muted); }
        .toggle-text:hover { color: var(--primary); text-decoration: underline; }
        .msg-box { font-size: 0.9rem; margin-bottom: 15px; min-height: 20px; }

        /* --- DASHBOARD HERO --- */
        .hero { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 40px; animation: fadeIn 0.8s; }
        .hero-card {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 24px; padding: 40px; color: white; position: relative;
            box-shadow: 0 15px 30px rgba(15, 118, 110, 0.3);
        }
        .logout-btn {
            position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2);
            border: none; color: white; padding: 8px 15px; border-radius: 8px; cursor: pointer;
        }
        .logout-btn:hover { background: rgba(255,255,255,0.3); }

        .todo-widget {
            background: white; border-radius: 24px; padding: 25px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column;
        }
        .todo-input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .todo-input { flex: 1; padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px; outline:none; }
        .todo-btn { background: var(--primary); border: none; color: white; border-radius: 8px; width: 35px; cursor: pointer; }
        .todo-list { list-style: none; padding: 0; max-height: 150px; overflow-y: auto; }
        .todo-item { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid #f1f5f9; font-size: 0.95rem; }
        .check-circle { width: 18px; height: 18px; border: 2px solid var(--primary); border-radius: 50%; cursor: pointer; }
        .check-circle.checked { background: var(--primary); }
        .todo-item.completed span { text-decoration: line-through; color: #94a3b8; }

        /* --- GRID CARDS --- */
        .grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 25px; animation: slideUp 0.8s ease; }
        .card {
            background: white; border: 1px solid #e2e8f0; width: 280px; padding: 30px 20px;
            border-radius: 20px; cursor: pointer; position: relative; overflow: hidden;
            text-align: center; display: flex; flex-direction: column; align-items: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        /* Line Effect */
        .card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px;
            background: var(--primary); transform: scaleX(0); transform-origin: left; transition: transform 0.3s ease;
        }
        .card:hover::before { transform: scaleX(1); }
        .icon-box {
            width: 60px; height: 60px; background: #f0fdf4; border-radius: 16px;
            display: flex; align-items: center; justify-content: center; font-size: 1.6rem; color: var(--primary); margin-bottom: 15px;
        }

        /* --- BRAIN BUTTON (Dashboard Only) --- */
        .fab {
            position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px;
            background: var(--primary); color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 1.8rem;
            cursor: pointer; box-shadow: 0 10px 30px rgba(21, 128, 61, 0.4); z-index: 100;
            animation: bounceIn 1s;
        }
        .fab:hover { transform: scale(1.1); }

        /* --- FULL SCREEN VIEWER (FOCUS MODE) --- */
        .viewer-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-viewer); z-index: 1500;
            display: none; flex-direction: column; animation: fadeIn 0.4s;
        }
        .viewer-overlay.active { display: flex; }

        .focus-header {
            padding: 10px 20px; background: white; border-bottom: 1px solid #e2e8f0;
            display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        .back-btn {
            background: #f1f5f9; border: none; color: var(--text-muted);
            padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;
            display: flex; align-items: center; gap: 8px;
        }
        .back-btn:hover { background: #e2e8f0; color: var(--text-main); }
        
        iframe { flex: 1; width: 100%; border: none; background: var(--bg-viewer); }

        /* --- SIDE PANEL (RIGHT DRAWER) --- */
        .side-panel {
            position: fixed; top: 0; right: -400px; width: 400px; height: 100%;
            background: white; z-index: 2000; box-shadow: -5px 0 30px rgba(0,0,0,0.1);
            transition: right 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex; flex-direction: column;
        }
        .side-panel.open { right: 0; }

        /* The Handle (Arrow) */
        .panel-handle {
            position: absolute; top: 50%; left: -40px; width: 40px; height: 80px;
            background: white; border-radius: 12px 0 0 12px;
            box-shadow: -4px 0 10px rgba(0,0,0,0.05);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: var(--primary); font-size: 1.2rem;
            transform: translateY(-50%); transition: 0.2s;
            border-left: 3px solid var(--primary);
        }
        .panel-handle:hover { padding-right: 5px; }

        /* Side Panel Content */
        .panel-content { padding: 30px; overflow-y: auto; height: 100%; }
        .panel-title { font-size: 1.2rem; font-weight: 700; margin-bottom: 20px; color: var(--primary); border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; }

        /* Notepad */
        .notepad {
            width: 100%; height: 200px; padding: 15px; border-radius: 12px;
            border: 1px solid #e2e8f0; background: #fffbeb; /* Yellow Note Paper */
            font-family: 'Outfit', sans-serif; font-size: 0.95rem; line-height: 1.5;
            resize: vertical; outline: none; box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
            margin-bottom: 30px;
        }
        .notepad:focus { border-color: var(--accent); }

        /* Timer in Panel */
        .timer-display { font-size: 3rem; font-weight: 800; text-align: center; color: var(--text-main); margin: 20px 0; font-variant-numeric: tabular-nums; }
        .modes-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .btn-mode {
            background: #f1f5f9; border: 1px solid #e2e8f0; padding: 10px;
            border-radius: 8px; cursor: pointer; font-size: 0.85rem; color: var(--text-muted);
            display: flex; flex-direction: column; align-items: center; gap: 5px;
        }
        .btn-mode.active { background: var(--primary); color: white; border-color: var(--primary); }
        .btn-action { width: 100%; padding: 12px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; margin-top: 10px; }
        .btn-start { background: var(--primary); color: white; }
        .btn-stop { background: var(--error); color: white; display: none; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounceIn { 0% { transform: scale(0); } 60% { transform: scale(1.1); } 100% { transform: scale(1); } }

    </style>
</head>
<body>

    <div id="loginScreen" class="login-wrapper">
        <div class="login-box">
            <div style="font-size:3rem; color:var(--primary); margin-bottom:10px"><i class="fas fa-seedling"></i></div>
            <h2 id="formTitle">Uni Hub</h2>
            <div id="loginMsg" class="msg-box"></div>
            <input type="text" id="username" class="login-input" placeholder="ÎŒÎ½Î¿Î¼Î± Î§ÏÎ®ÏƒÏ„Î·">
            <input type="password" id="password" class="login-input" placeholder="ÎšÏ‰Î´Î¹ÎºÏŒÏ‚">
            <button class="login-btn" onclick="handleAuth()">Î£ÏÎ½Î´ÎµÏƒÎ·</button>
            <div class="toggle-text" onclick="toggleAuthMode()"><span id="toggleText">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï</span></div>
        </div>
    </div>

    <div id="mainContainer" class="container">
        <div class="hero">
            <div class="hero-card">
                <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ÎˆÎ¾Î¿Î´Î¿Ï‚</button>
                <h1 id="greeting">ÎšÎ±Î»Î·ÏƒÏ€Î­ÏÎ±!</h1>
                <p>Focus Mode: Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿.</p>
                <div style="margin-top:20px; font-weight:600; display:inline-flex; align-items:center; gap:8px; background:rgba(255,255,255,0.2); padding:5px 15px; border-radius:20px">
                    <i class="fas fa-check-circle"></i> <span id="sessionCount">0</span> ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½ÎµÏ‚ Î£Ï…Î½ÎµÎ´ÏÎ¯ÎµÏ‚
                </div>
            </div>
            <div class="todo-widget">
                <div style="font-weight:700; margin-bottom:10px; color:var(--primary)">Î£Î·Î¼ÎµÏÎ¹Î½Î® Î›Î¯ÏƒÏ„Î±</div>
                <div class="todo-input-group">
                    <input type="text" id="todoInput" class="todo-input" placeholder="Î“ÏÎ¬ÏˆÎµ ÏƒÏ„ÏŒÏ‡Î¿...">
                    <button class="todo-btn" onclick="addTodo()"><i class="fas fa-plus"></i></button>
                </div>
                <ul class="todo-list" id="todoList"></ul>
            </div>
        </div>
        <main id="app" class="grid"></main>
    </div>

    <div class="fab" id="dashTimerBtn" onclick="toggleSidePanel()">
        <i class="fas fa-brain"></i>
    </div>

    <div class="viewer-overlay" id="viewerOverlay">
        <div class="focus-header">
            <button class="back-btn" onclick="closeViewer()">
                <i class="fas fa-arrow-left"></i> Î Î¯ÏƒÏ‰
            </button>
            <div style="font-weight:600; color:var(--primary)" id="viewerTitle">ÎœÎ¬Î¸Î·Î¼Î±</div>
            <div style="width:80px"></div> </div>
        <iframe id="contentFrame" src=""></iframe>
    </div>

    <div class="side-panel" id="sidePanel">
        <div class="panel-handle" onclick="toggleSidePanel()">
            <i class="fas fa-chevron-left" id="handleIcon"></i>
        </div>

        <div class="panel-content">
            <div class="panel-title"><i class="fas fa-stopwatch"></i> Î§ÏÎ¿Î½ÏŒÎ¼ÎµÏ„ÏÎ¿</div>
            <div class="modes-grid">
                <button class="btn-mode active" onclick="setMode(25, 'Pomodoro', this)">ğŸ… 25'</button>
                <button class="btn-mode" onclick="setMode(50, 'Deep', this)">ğŸ§  50'</button>
                <button class="btn-mode" onclick="setMode(90, 'Flow', this)">ğŸŒŠ 90'</button>
                <button class="btn-mode" onclick="setMode(5, 'Quick', this)">âš¡ 5'</button>
            </div>
            <div class="timer-display" id="timeDisplay">25:00</div>
            <button class="btn-action btn-start" id="startBtn" onclick="startTimer()">ÎˆÎ½Î±ÏÎ¾Î·</button>
            <button class="btn-action btn-stop" id="stopBtn" onclick="resetTimer()">Î”Î¹Î±ÎºÎ¿Ï€Î®</button>
            
            <hr style="border:0; border-top:1px solid #f1f5f9; margin:30px 0">

            <div class="panel-title"><i class="fas fa-pen"></i> Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚</div>
            <textarea class="notepad" id="scratchpad" placeholder="Î“ÏÎ¬ÏˆÎµ Î³ÏÎ®Î³Î¿ÏÎµÏ‚ ÏƒÎºÎ­ÏˆÎµÎ¹Ï‚ ÎµÎ´Ï... (Î‘Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î±)" oninput="saveScratchpad()"></textarea>
        </div>
    </div>

    <audio id="alarmSound" src="https://assets.mixkit.co/sfx/preview/mixkit-positive-notification-951.mp3"></audio>

    <script>
        // --- DATA ---
       const subjects = [
            { 
                id: 1, 
                title: "Î‘Î½Î±Ï„Î¿Î¼Î¯Î± III", 
                icon: "fa-skull",
                files: [
                    { name: "ÎšÎµÏ† 1: Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®", file: "test.html" },
                    { name: "ÎšÎµÏ† 2: ÎÎµÏ…ÏÎ¹ÎºÏŒ", file: "test.html" }
                ]
            },
            { 
                id: 2, 
                title: "Î•Î¼Î²ÏÏ…Î¿Î»Î¿Î³Î¯Î±", 
                icon: "fa-baby-carriage",
                files: [
                    { name: "ÎšÎµÏ† 1: Î“Î¿Î½Î¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎ·", file: "test.html" }
                ]
            },
            { 
                id: 3, 
                title: "Î™Î±Ï„ÏÎ¹ÎºÎ® Î“ÎµÎ½ÎµÏ„Î¹ÎºÎ®", 
                icon: "fa-dna", 
                files: [ 
                    { name: "ÎšÎµÏ† 1: Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®", file: "test.html" }, 
                    { name: "ÎšÎµÏ† 2: ÎšÎ»Î·ÏÎ¿Î½Î¿Î¼Î¹ÎºÏŒÏ„Î·Ï„Î±", file: "test.html" } 
                ] 
            }, 
            { 
                id: 4, 
                title: "ÎŸÎ´Î¿Î½Ï„Î¹ÎºÎ® Î§ÎµÎ¹ÏÎ¿Ï…ÏÎ³Î¹ÎºÎ®", 
                icon: "fa-tooth", 
                files: [ 
                    { name: "ÎšÎµÏ† 1: Î•Î¹ÏƒÎ±Î³Ï‰Î³Î®", file: "test.html" } 
                ] 
            }, 
            { 
                id: 5, 
                title: "Î ÏÎ¿ÎºÎ»Î¹Î½Î¹ÎºÎ®", 
                icon: "fa-notes-medical", 
                files: [ 
                    { name: "ÎšÎµÏ† 1: Î•ÏÎ³Î±Î»ÎµÎ¯Î±", file: "test.html" }, 
                    { name: "ÎšÎµÏ† 2: Î¤ÎµÏ‡Î½Î¹ÎºÎ­Ï‚", file: "test.html" } 
                ] 
            }, 
            { 
                id: 6, 
                title: "Î‘ÎºÏ„Î¹Î½Î¿Î»Î¿Î³Î¯Î±", 
                icon: "fa-x-ray", 
                files: [ 
                    { name: "ÎšÎµÏ† 1: Î‘ÎºÏ„Î¯Î½ÎµÏ‚ Î§", file: "test.html" } 
                ] 
            }, 
            { 
                id: 7, 
                title: "Î ÏÎ¿Î»Î·Ï€Ï„Î¹ÎºÎ® ÎŸÎ´Î¿Î½Ï„Î¹Î±Ï„ÏÎ¹ÎºÎ®", 
                icon: "fa-shield-virus", 
                files: [ 
                    { name: "ÎšÎµÏ† 1: Î¦Î¸Î¿ÏÎ¯Ï‰ÏƒÎ·", file: "test.html" }, 
                    { name: "ÎšÎµÏ† 2: Î£Ï„Î¿Î¼Î±Ï„Î¹ÎºÎ® Î¥Î³Î¹ÎµÎ¹Î½Î®", file: "test.html" } 
                ] 
            } 
        ];
        // --- AUTH & STATE ---
        let currentUser = null;
        let isLoginMode = true;

        function getUsers() { return JSON.parse(localStorage.getItem('uni_users') || '{}'); }

        function handleAuth() {
            const u = document.getElementById('username').value.trim();
            const p = document.getElementById('password').value.trim();
            const db = getUsers();
            const msg = document.getElementById('loginMsg');

            if(!u || !p) { msg.innerText="Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ Ï„Î± Ï€ÎµÎ´Î¯Î±"; msg.style.color="red"; return; }

            if(isLoginMode) {
                if(db[u] === p) loginSuccess(u);
                else { msg.innerText="Î›Î¬Î¸Î¿Ï‚ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î±"; msg.style.color="red"; }
            } else {
                if(db[u]) { msg.innerText="Î¤Î¿ ÏŒÎ½Î¿Î¼Î± Ï…Ï€Î¬ÏÏ‡ÎµÎ¹"; msg.style.color="red"; }
                else {
                    db[u] = p; localStorage.setItem('uni_users', JSON.stringify(db));
                    msg.innerText="Î•Ï€Î¹Ï„Ï…Ï‡Î¯Î±! Î£Ï…Î½Î´Î­ÏƒÎ¿Ï…."; msg.style.color="green";
                    setTimeout(toggleAuthMode, 1000);
                }
            }
        }

        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            document.getElementById('formTitle').innerText = isLoginMode ? 'Uni Hub' : 'Î•Î³Î³ÏÎ±Ï†Î®';
            document.querySelector('.login-btn').innerText = isLoginMode ? 'Î£ÏÎ½Î´ÎµÏƒÎ·' : 'Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±';
            document.getElementById('toggleText').innerText = isLoginMode ? 'Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï' : 'ÎˆÏ‡ÎµÎ¹Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ; Login';
            document.getElementById('loginMsg').innerText = '';
        }

        function loginSuccess(user) {
            currentUser = user;
            document.getElementById('loginScreen').style.display = 'none';
            document.querySelector('.container').style.display = 'block';
            document.getElementById('dashTimerBtn').style.display = 'flex';
            
            const h = new Date().getHours();
            document.getElementById('greeting').innerText = (h<12?"ÎšÎ±Î»Î·Î¼Î­ÏÎ±":h>19?"ÎšÎ±Î»Î·Î½ÏÏ‡Ï„Î±":"ÎšÎ±Î»Î·ÏƒÏ€Î­ÏÎ±") + `, ${user}!`;
            
            loadUserData();
            renderGrid();
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginScreen').style.display = 'flex';
            document.querySelector('.container').style.display = 'none';
            document.getElementById('dashTimerBtn').style.display = 'none';
            closeViewer(); // Ensure viewer is closed
        }

        // --- USER DATA ---
        function loadUserData() {
            // Todos
            const todos = JSON.parse(localStorage.getItem(`${currentUser}_todos`) || '[]');
            const list = document.getElementById('todoList');
            list.innerHTML = '';
            todos.forEach(t => createTodoEl(t.text, t.completed));
            // Streak
            document.getElementById('sessionCount').innerText = localStorage.getItem(`${currentUser}_streak`) || 0;
            // Scratchpad
            document.getElementById('scratchpad').value = localStorage.getItem(`${currentUser}_notes`) || '';
        }

        function saveTodos() {
            const items = [];
            document.querySelectorAll('.todo-item').forEach(el => {
                items.push({ text: el.querySelector('span').innerText, completed: el.classList.contains('completed') });
            });
            localStorage.setItem(`${currentUser}_todos`, JSON.stringify(items));
        }

        function addTodo() {
            const val = document.getElementById('todoInput').value.trim();
            if(!val) return;
            createTodoEl(val, false); saveTodos();
            document.getElementById('todoInput').value = '';
        }

        function createTodoEl(text, completed) {
            const li = document.createElement('li');
            li.className = `todo-item ${completed?'completed':''}`;
            li.innerHTML = `<div class="check-circle ${completed?'checked':''}" onclick="toggleTask(this)"></div><span>${text}</span><i class="fas fa-times" style="margin-left:auto; cursor:pointer; opacity:0.4" onclick="this.parentElement.remove(); saveTodos()"></i>`;
            document.getElementById('todoList').appendChild(li);
        }

        function toggleTask(el) {
            el.classList.toggle('checked'); el.parentElement.classList.toggle('completed'); saveTodos();
        }

        function saveScratchpad() {
            localStorage.setItem(`${currentUser}_notes`, document.getElementById('scratchpad').value);
        }

        // --- GRID & NAVIGATION ---
        const app = document.getElementById('app');

        function renderGrid() {
            let html = '';
            subjects.forEach(sub => {
                html += `
                <div class="card" onclick="openSubject(${sub.id})">
                    <div class="icon-box"><i class="fas ${sub.icon}"></i></div>
                    <h3>${sub.title}</h3>
                    <span style="opacity:0.6; font-size:0.85rem; margin-top:5px">${sub.files.length} Î‘ÏÏ‡ÎµÎ¯Î±</span>
                </div>`;
            });
            app.innerHTML = html;
        }

        function openSubject(id) {
            const sub = subjects.find(s => s.id === id);
            // Simple overlay for file selection within grid area
            let html = `
            <div style="width:100%">
                <button onclick="renderGrid()" style="background:none; border:none; color:var(--primary); cursor:pointer; font-size:1.1rem; margin-bottom:20px; font-weight:600">
                    <i class="fas fa-arrow-left"></i> Î Î¯ÏƒÏ‰
                </button>
                <h2 style="color:var(--primary); margin-bottom:20px">${sub.title}</h2>
                <div class="grid" style="justify-content:flex-start">`;
            
            if(sub.files.length === 0) html += '<p>ÎšÎµÎ½ÏŒ.</p>';
            else sub.files.forEach(f => {
                html += `<div class="card" onclick="openViewer('${f.file}', '${f.name}')">
                    <div class="icon-box"><i class="fas fa-file-alt"></i></div>
                    <h3>${f.name}</h3>
                </div>`;
            });
            html += '</div></div>';
            app.innerHTML = html;
        }

        // --- VIEWER & FOCUS LOGIC ---
        function openViewer(file, name) {
            document.getElementById('contentFrame').src = file;
            document.getElementById('viewerTitle').innerText = name;
            
            // Show Overlay
            document.getElementById('viewerOverlay').classList.add('active');
            
            // HIDE Dashboard Brain Button
            document.getElementById('dashTimerBtn').style.display = 'none';
            
            // Ensure Side Panel is closed initially but handle is visible
            document.getElementById('sidePanel').classList.remove('open');
        }

        function closeViewer() {
            document.getElementById('viewerOverlay').classList.remove('active');
            document.getElementById('contentFrame').src = "";
            
            // SHOW Dashboard Brain Button again
            document.getElementById('dashTimerBtn').style.display = 'flex';
            
            // Close side panel
            document.getElementById('sidePanel').classList.remove('open');
        }

        // --- SIDE PANEL LOGIC ---
        function toggleSidePanel() {
            const panel = document.getElementById('sidePanel');
            panel.classList.toggle('open');
            
            const icon = document.getElementById('handleIcon');
            if(panel.classList.contains('open')) icon.className = "fas fa-chevron-right";
            else icon.className = "fas fa-chevron-left";
        }

        // --- TIMER LOGIC ---
        let timer; let timeLeft = 25 * 60; let isRunning = false;

        function setMode(min, name, btn) {
            if(isRunning) return;
            timeLeft = min * 60; updateDisplay();
            document.querySelectorAll('.btn-mode').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function updateDisplay() {
            const m = Math.floor(timeLeft/60).toString().padStart(2,'0');
            const s = (timeLeft%60).toString().padStart(2,'0');
            document.getElementById('timeDisplay').innerText = `${m}:${s}`;
        }

        function startTimer() {
            if(isRunning) return; isRunning = true;
            document.getElementById('startBtn').style.display='none';
            document.getElementById('stopBtn').style.display='inline-block';
            timer = setInterval(() => {
                timeLeft--; updateDisplay();
                if(timeLeft <= 0) timeUp();
            }, 1000);
        }

        function resetTimer() {
            clearInterval(timer); isRunning = false;
            document.getElementById('startBtn').style.display='inline-block';
            document.getElementById('stopBtn').style.display='none';
        }

        function timeUp() {
            resetTimer();
            document.getElementById('alarmSound').play();
            alert("ÎŸ Î§ÏÏŒÎ½Î¿Ï‚ Î¤Î­Î»ÎµÎ¹Ï‰ÏƒÎµ! ÎšÎ¬Î½Îµ Î´Î¹Î¬Î»ÎµÎ¹Î¼Î¼Î±.");
            
            let streak = parseInt(localStorage.getItem(`${currentUser}_streak`) || 0) + 1;
            localStorage.setItem(`${currentUser}_streak`, streak);
            document.getElementById('sessionCount').innerText = streak;
            
            timeLeft = 25 * 60; updateDisplay();
        }
    </script>
</body>
</html>
